var e={componentPrefix:"mwmbl",publicApiURL:"https://api.mwmbl.org/",searchQueryParam:"q",footerLinks:[{name:"Github",icon:"ph-github-logo-bold",href:"https://github.com/mwmbl/mwmbl"},{name:"Wiki",icon:"ph-info-bold",href:"https://github.com/mwmbl/mwmbl/wiki"}]},t=(t,s,n)=>{const r=`${e.componentPrefix}-${t}`;return customElements.get(r)||customElements.define(r,s,n),r};const s=new class{constructor(){this.element=document.createElement("div")}on(e,t){this.element.addEventListener(e,t)}dispatch(e){this.element.dispatchEvent(e)}};var n,r,a,i,l={};n=l,r="default",a=()=>o,i=e=>o=e,Object.defineProperty(n,r,{get:a,set:i,enumerable:!0,configurable:!0});var o=(e,t=100)=>{let s;return(...n)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(void 0,n)}),t)}};const c=window.matchMedia("(prefers-reduced-motion)").matches;t("search-bar",class extends HTMLElement{constructor(){super(),this.searchInput=null,this.searchForm=null,this.abortController=new AbortController,this.__setup()}__setup(){this.innerHTML="\n  <form class=\"search-bar\">\n    <i class=\"ph-magnifying-glass-bold\"></i>\n    <input \n      type='search' \n      class='search-bar-input' \n      placeholder='Search on mwmbl...' \n      title='Use \"CTRL+K\" or \"/\" to focus.'\n      autocomplete='off'\n    >\n  </form>\n",this.searchInput=this.querySelector("input"),this.searchForm=this.querySelector("form"),this.__events()}__events(){const t=async t=>{t.preventDefault(),document.title=`MWMBL - ${this.searchInput.value||"Search"}`;const n=new URLSearchParams(document.location.search);this.searchInput.value?n.set(e.searchQueryParam,this.searchInput.value):n.delete(e.searchQueryParam);const r=document.location.protocol+"//"+document.location.host+document.location.pathname+(this.searchInput.value?"?":"")+n.toString();if(window.history.replaceState({path:r},"",r),this.searchInput.value){document.body.style.paddingTop="25px",document.querySelector(".search-menu").classList.add("compact");try{this.abortController.abort(),this.abortController=new AbortController;const t=await fetch(`${e.publicApiURL}search?s=${encodeURIComponent(this.searchInput.value)}`,{signal:this.abortController.signal}),n=await t.json(),r=new CustomEvent("search",{detail:{results:this.searchInput.value?n:null,error:null}});s.dispatch(r)}catch(e){const t=new CustomEvent("search",{detail:{results:null,error:e}});s.dispatch(t)}}else{document.body.style.paddingTop="30vh",document.querySelector(".search-menu").classList.remove("compact");const e=new CustomEvent("search",{detail:{results:null,error:null}});s.dispatch(e)}};this.searchForm.addEventListener("submit",(e=>{e.preventDefault(),t(e)})),c||this.searchInput.addEventListener("input",(0,l.default)(t,500)),document.addEventListener("keydown",(e=>{("k"===e.key&&e.ctrlKey||"/"===e.key||"Escape"===e.key)&&(e.preventDefault(),this.searchInput.focus())})),this.addEventListener("keydown",(e=>{if("ArrowDown"===e.key&&this.searchInput.value){e.preventDefault();const t=new CustomEvent("focus-result");s.dispatch(t)}})),s.on("focus-search",(e=>{this.searchInput.focus()}))}connectedCallback(){this.searchInput.focus();const t=new URLSearchParams(document.location.search).get(e.searchQueryParam);this.searchInput.value=t,this.searchInput.dispatchEvent(new Event("input"))}});var u=e=>String(e).replace(/[^\w. ]/gi,(e=>`&#${e.charCodeAt(0)};`));var h=t("result",class extends HTMLLIElement{constructor(){super(),this.classList.add("result"),this.__setup()}__setup(){this.innerHTML=(({data:e})=>`\n  <a href='${e.url}'>\n    <p class='link'>${e.url}</p>\n    <p class='title'>${e.title}</p>\n    <p class='extract'>${e.extract}</p>\n  </a>\n`)({data:{url:this.dataset.url,title:this.__handleBold(JSON.parse(this.dataset.title)),extract:this.__handleBold(JSON.parse(this.dataset.extract))}}),this.__events()}__events(){this.addEventListener("keydown",(e=>{if(this.firstElementChild===document.activeElement&&("ArrowDown"===e.key&&(e.preventDefault(),this?.nextElementSibling?.firstElementChild.focus()),"ArrowUp"===e.key))if(e.preventDefault(),this.previousElementSibling)this.previousElementSibling?.firstElementChild.focus();else{const e=new CustomEvent("focus-search");s.dispatch(e)}}))}__handleBold(e){let t="";for(const s of e)s.is_bold?t+=`<strong>${u(s.value)}</strong>`:t+=u(s.value);return t}},{extends:"li"});var d=t("empty-result",class extends HTMLLIElement{constructor(){super(),this.classList.add("empty-result"),this.__setup()}__setup(){this.innerHTML="\n  <p>We could not find anything for your search...</p>\n"}},{extends:"li"});var p=t("home",class extends HTMLLIElement{constructor(){super(),this.classList.add("home"),this.__setup()}__setup(){this.innerHTML="\n  <h1>\n    Welcome to mwmbl, the free, open-source and non-profit search engine.\n  </h1>\n  <p>\n    You can start searching by using the search bar above!\n  </p>\n"}},{extends:"li"});t("results",class extends HTMLElement{constructor(){super(),this.results=null,this.__setup()}__setup(){this.innerHTML=`\n  <ul class='results'>\n    <li is='${p}'></li>\n  </ul>\n`,this.results=this.querySelector(".results"),this.__events()}__events(){s.on("search",(e=>{this.results.innerHTML="";let t="";if(e.detail.error)t=`\n          <li is='${d}'></li>\n        `;else if(e.detail.results)if(e.detail.results.length>0)for(const s of e.detail.results)t+=`\n              <li\n                is='${h}' \n                data-url='${u(s.url)}'\n                data-title='${u(JSON.stringify(s.title))}'\n                data-extract='${u(JSON.stringify(s.extract))}'\n              ></li>\n            `;else t=`\n            <li is='${d}'></li>\n          `;else t=`\n            <li is='${p}'></li>\n          `;this.results.innerHTML=t})),s.on("focus-result",(()=>{this.results.firstElementChild.firstElementChild.focus()}))}});t("footer",class extends HTMLElement{constructor(){super(),this.__setup()}__setup(){this.innerHTML=(({data:e})=>`\n  <p class="footer-text">Find more on</p>\n  <ul class="footer-list">\n    ${e.links.map((e=>`\n      <li class="footer-item">\n        <a href="${e.href}" class="footer-link" target="__blank">\n          <i class="${e.icon}"></i>\n          <span>${e.name}</span>\n        </a>\n      </li>\n    `)).join("")}\n  </ul>\n`)({data:{links:e.footerLinks}}),this.__events()}__events(){}},{extends:"footer"});
var n=Object.defineProperty;var h=(s,e,t)=>e in s?n(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>(h(s,typeof e!="symbol"?e+"":e,t),t);import{d as i}from"./define.b7078a0a.js";import{c as r}from"./config.d02c906f.js";import{g as c}from"./events.7f8add71.js";const l=(s,e=100)=>{let t;return(...a)=>{clearTimeout(t),t=setTimeout(()=>{s.apply(globalThis,a)},e)}},u=window.matchMedia("(prefers-reduced-motion)").matches,p=()=>`
  <form class="search-bar">
    <i class="ph-magnifying-glass-bold"></i>
    <input 
      type='search' 
      class='search-bar-input' 
      placeholder='Search on mwmbl...' 
      title='Use "CTRL+K" or "/" to focus.'
      autocomplete='off'
    >
  </form>
`,y=i("search-bar",class extends HTMLElement{constructor(){super();o(this,"__handleSearch",async()=>{document.title=`MWMBL - ${this.searchInput.value||"Search"}`;const e=new URLSearchParams(document.location.search);this.searchInput.value?e.set(r.searchQueryParam,this.searchInput.value):e.delete(r.searchQueryParam);const t=document.location.protocol+"//"+document.location.host+document.location.pathname+(this.searchInput.value?"?":"")+e.toString();if(window.history.replaceState({path:t},"",t),this.searchInput.value){this.__setDisplayMode("compact");try{const a=await this.__executeSearch();this.__dispatchSearch({results:this.searchInput.value?a:null})}catch(a){this.__dispatchSearch({error:a})}}else this.__setDisplayMode("home"),this.__dispatchSearch({results:null})});this.searchInput=null,this.searchForm=null,this.abortController=new AbortController,this.__setup()}__setup(){this.innerHTML=p(),this.searchInput=this.querySelector("input"),this.searchForm=this.querySelector("form"),this.__events()}__dispatchSearch({results:e=null,error:t=null}){const a=new CustomEvent("search",{detail:{results:e,error:t}});c.dispatch(a)}__setDisplayMode(e){switch(e){case"compact":{document.body.style.paddingTop="25px",document.querySelector(".search-menu").classList.add("compact");break}case"home":{document.body.style.paddingTop="30vh",document.querySelector(".search-menu").classList.remove("compact");break}}}async __executeSearch(){return this.abortController.abort(),this.abortController=new AbortController,await(await fetch(`${r.publicApiURL}search?s=${encodeURIComponent(this.searchInput.value)}`,{signal:this.abortController.signal})).json()}__events(){this.searchForm.addEventListener("submit",e=>{e.preventDefault(),this.__handleSearch(e)}),u||this.searchInput.addEventListener("input",l(this.__handleSearch,500)),document.addEventListener("keydown",e=>{(e.key==="k"&&e.ctrlKey||e.key==="/"||e.key==="Escape")&&(e.preventDefault(),this.searchInput.focus())}),this.addEventListener("keydown",e=>{if(e.key==="ArrowDown"&&this.searchInput.value){e.preventDefault();const t=new CustomEvent("focus-result");c.dispatch(t)}}),c.on("focus-search",e=>{this.searchInput.focus()})}connectedCallback(){this.searchInput.focus();const e=new URLSearchParams(document.location.search).get(r.searchQueryParam);this.searchInput.value=e,this.__handleSearch()}});export{y as default};

!function(){function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}System.register(["./define-legacy.354b0b1c.js","./config-legacy.967760ef.js","./events-legacy.37a86182.js"],(function(t,r){"use strict";var s,a,n;return{setters:[e=>{s=e.d},e=>{a=e.c},e=>{n=e.g}],execute:function(){const r=window.matchMedia("(prefers-reduced-motion)").matches;t("default",s("search-bar",class extends HTMLElement{constructor(){super(),e(this,"__handleSearch",(async()=>{document.title=`MWMBL - ${this.searchInput.value||"Search"}`;const e=new URLSearchParams(document.location.search);this.searchInput.value?e.set(a.searchQueryParam,this.searchInput.value):e.delete(a.searchQueryParam);const t=document.location.protocol+"//"+document.location.host+document.location.pathname+(this.searchInput.value?"?":"")+e.toString();if(window.history.replaceState({path:t},"",t),this.searchInput.value){this.__setDisplayMode("compact");try{const e=await this.__executeSearch();this.__dispatchSearch({results:this.searchInput.value?e:null})}catch(r){this.__dispatchSearch({error:r})}}else this.__setDisplayMode("home"),this.__dispatchSearch({results:null})})),this.searchInput=null,this.searchForm=null,this.abortController=new AbortController,this.__setup()}__setup(){this.innerHTML="\n  <form class=\"search-bar\">\n    <i class=\"ph-magnifying-glass-bold\"></i>\n    <input \n      type='search' \n      class='search-bar-input' \n      placeholder='Search on mwmbl...' \n      title='Use \"CTRL+K\" or \"/\" to focus.'\n      autocomplete='off'\n    >\n  </form>\n",this.searchInput=this.querySelector("input"),this.searchForm=this.querySelector("form"),this.__events()}__dispatchSearch({results:e=null,error:t=null}){const r=new CustomEvent("search",{detail:{results:e,error:t}});n.dispatch(r)}__setDisplayMode(e){switch(e){case"compact":document.body.style.paddingTop="25px",document.querySelector(".search-menu").classList.add("compact");break;case"home":document.body.style.paddingTop="30vh",document.querySelector(".search-menu").classList.remove("compact")}}async __executeSearch(){this.abortController.abort(),this.abortController=new AbortController;const e=await fetch(`${a.publicApiURL}search?s=${encodeURIComponent(this.searchInput.value)}`,{signal:this.abortController.signal});return await e.json()}__events(){this.searchForm.addEventListener("submit",(e=>{e.preventDefault(),this.__handleSearch(e)})),r||this.searchInput.addEventListener("input",((e,t=100)=>{let r;return(...s)=>{clearTimeout(r),r=setTimeout((()=>{e.apply(globalThis,s)}),t)}})(this.__handleSearch,500)),document.addEventListener("keydown",(e=>{("k"===e.key&&e.ctrlKey||"/"===e.key||"Escape"===e.key)&&(e.preventDefault(),this.searchInput.focus())})),this.addEventListener("keydown",(e=>{if("ArrowDown"===e.key&&this.searchInput.value){e.preventDefault();const t=new CustomEvent("focus-result");n.dispatch(t)}})),n.on("focus-search",(e=>{this.searchInput.focus()}))}connectedCallback(){this.searchInput.focus();const e=new URLSearchParams(document.location.search).get(a.searchQueryParam);this.searchInput.value=e,this.__handleSearch()}}))}}}))}();
